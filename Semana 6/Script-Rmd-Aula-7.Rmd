---
title: "Prova P2 - MAF 172 - 2022-2"
author: "Erich Müller Dutra - Matrícula 4908"
date: "2022-11-07"
fig_caption: yes
output:
  html_document:
    highlight: pygments
    keep_md: yes
    lib_dir: libs
    mathjax: local
    number_sections: yes
    self_contained: no
    theme: cerulean
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
  word_document:
    toc: yes
  pdf_document:
    toc: yes
fig_width: 7
fig_height: 7
editor_options:
  chunk_output_type: console
---

# - Introdução

Nesta seção, estudamos a relação entre diferentes variáveis aplicadas à ciência de dados no R. Neste trabalho, investiguei a relação entre notas de corte para acesso ao curso de administração através do SiSU, investimentos educacionais e população da cidade em questão. Foram coletadas 8 amostras através de dados públicos disponíveis na plataforma do SiSU, portal da transparência e IBGE.

# - Objetivo

A principal motivação é estudar se há relação direta entre dados das localidades e a concorrência para o curso de administração através do SiSU.

# - Descrição das Variáveis

## - Fonte
Os dados coletados foram obtidos através das seguintes fontes:
https://sisu.mec.gov.br/#/relatorio#onepage
https://cidades.ibge.gov.br
https://www.portaltransparencia.gov.br/funcoes/12-educacao?ano=2020

## - Preparação do ambiente
A partir daqui, iremos analisar a relação entre as variáveis. Inicialmente, vamos preparar o ambiente.

```{r}
# Define o diretório de trabalho
# setwd("~Documents/Erich/GitHub/MAF_172") 

# Instalando dependências
library(pacman)
p_load(char=c("DescTools","readxl","janitor", "psych", "corrr", "ggplot2", "dplyr", "caret", "corrplot","spatstat", "maptools", "gstat", "foreign", "geoR","moments","scatterplot3d","tcltk2", "sp", "rgdal", "raster", "doParallel", "GGally"))
```

## - Leitura dos dados
Faremos então a leitura dos dados que estão armazenados em um arquivo de texto (.txt).

```{r}
# Importando os dados
dados = read.table("../dados_prova.txt", head=T)
str(dados)

# Leitura dos dados importados
dados.rls = dados[1:4]
names(dados.rls)
```


## - Processamento dos dados

```{r}
# Processamento Paralelo e Matriz de Correlacao

# Processamento em paralelo
cl <- makePSOCKcluster(4)
registerDoParallel(cl)
# Aqui começa o procedimento
df2 <- cor(dados.rls, use = "na.or.complete")
corrplot(df2, order="alphabet", method="circle", tl.pos="td", type="upper", 
         tl.col="black", tl.cex=0.9, tl.srt=45, 
         addCoef.col="orange", addCoefasPercent = TRUE, diag = TRUE,
         sig.level=0.995, p.mat = 1-abs(df2),insig = "blank")
# Aqui termina o procedimento
stopCluster(cl)

######################################################################
### Outra Matriz de Correlacao
######################################################################

cl <- makePSOCKcluster(4); registerDoParallel(cl)
# Aqui começa o procedimento
ggpairs(dados.rls)
# Aqui termina o procedimento
stopCluster(cl)

######################################################################
### Subprocessamento dos Dados
######################################################################

temp.1 = dados.rls[1:10]
temp.2 = dados.rls[11:20]
# Processamento em paralelo
cl <- makePSOCKcluster(4); registerDoParallel(cl)
# Aqui começa o procedimento
ggpairs(temp.1)
ggpairs(temp.2)
# Aqui termina o procedimento
stopCluster(cl)

######################################################################
### Matriz de Correlacao Nao-Linear
######################################################################

par(mfrow=c(1,1))
par(mar=c(8,4,6,4))
# Processamento em paralelo
cl <- makePSOCKcluster(4)
registerDoParallel(cl)
# Aqui começa o procedimento
# Função de Lopez-Paz (2013)
rdc <- function(x,y,k=20,s=1/6,f=sin) {
  set.seed(313)
  x <- cbind(apply(as.matrix(x),2,function(u)rank(u)/length(u)),1)
  y <- cbind(apply(as.matrix(y),2,function(u)rank(u)/length(u)),1)
  x <- s/ncol(x)*x%*%matrix(rnorm(ncol(x)*k),ncol(x))
  y <- s/ncol(y)*y%*%matrix(rnorm(ncol(y)*k),ncol(y))
  cancor(cbind(f(x),1),cbind(f(y),1))$cor[1]
}
# Tabela é o data.frame
tabela = dados.rls
correl_nao_linear <- function (tabela) {
  c = c("peraser")
  mcnl = matrix(nrow = ncol(tabela), ncol = ncol(tabela))  
  for (i in 1:ncol(tabela)) {
    for (j in 1:ncol(tabela)) {
      mcnl[i,j] = rdc(tabela[,i],tabela[,j])
    }
  }
  mcnl =as.data.frame(mcnl)
  colnames(mcnl) = colnames(tabela)
  rownames(mcnl) = colnames(tabela)
  return(mcnl)
}
par(mfrow=c(1,1))
cornl = correl_nao_linear(tabela)
corrplot(as.matrix(cornl),is.corr = F, method="circle", tl.srt=45,
         tl.pos="lt", type="upper",tl.col="black", addCoefasPercent = TRUE,
         sig.level=0.995, addCoef.col="orange")
# Aqui termina o procedimento
stopCluster(cl)

######################################################################
### Analisando 2 Variaveis
######################################################################

resp = dados.rls$v1
explic = dados.rls$v4

######################################################################
### Representacao Grafica
######################################################################

par(mfrow=c(1,1))
plot(explic, resp, main="Diagrama de Dispersão", 
     xlab = "Variável v4", ylab = "Variável v1") 
cov(explic, resp)
cor(explic, resp)

######################################################################
### Estimando
######################################################################

(rls = lm(resp~explic))

######################################################################
### Fazendo predicoes
######################################################################

(pred=predict(rls))
(obs=dados.rls$v4)
compara = cbind(obs, pred, obs-pred)
head(compara)
tail(compara)

######################################################################
### Representação Grafica da Performance
######################################################################

par(mar=c(6,4,4,4))
plot(explic, resp)
abline(rls)
text(10,18,expression("Y = 1,056 + 1,118 X"))

######################################################################
### Analise de Variancia da Regressao
######################################################################

anova(rls)
summary(rls)
names(summary(rls))
```